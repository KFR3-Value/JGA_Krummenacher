<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Trip Template</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;900&display=swap" rel="stylesheet">
    <style>
        body { font-family: 'Inter', sans-serif; background: #f3f4f6; }
        .calendar-day{ background:#fff;border:1px solid #d1d5db;border-radius:0.5rem;overflow:hidden }
        .day-header{ background:#f9fafb;padding:.75rem 1rem;border-bottom:1px solid #d1d5db }
        .day-title{ font-weight:700;color:#1f2937 }
        .day-subtitle{ color:#4b5563;font-size:.9rem }
        .timeline-wrapper{ position:relative; --hour-height:50px; --minute-height:calc(var(--hour-height)/60); height:calc(24*var(--hour-height)); background:#f9fafb }
        .hour-lines{ position:absolute; inset:0; display:flex; flex-direction:column }
        .hour-line{ height:var(--hour-height); border-bottom:1px solid #e5e7eb; display:flex; align-items:flex-start }
        .hour-label{ padding:.25rem .5rem; font-size:.75rem; color:#9ca3af; width:4rem; text-align:right }
        .event-block{ position:absolute; left:4.5rem; right:.5rem; background:#fff; border:1px solid #e5e7eb; border-left-width:4px; border-radius:.375rem; padding:.5rem .75rem; overflow:hidden }
        .party-slot{ background:#fef9c3; border-color:#f59e0b }
        .travel-slot{ background:#e0f2fe; border-color:#3b82f6 }
        .chill-slot{ background:#e0fbf0; border-color:#10b981 }
        .food-slot{ background:#ffe4e6; border-color:#ef4444 }
        .tab-button{ padding:.5rem 1rem; font-weight:600; border-radius:.5rem; cursor:pointer }
        .tab-button.active{ background:#fff; color:#3b82f6 }
        .tab-content{ display:none }
        .tab-content.active{ display:block }
        .embed-container, .map-container, .budget-container{ background:#fff;border:1px solid #d1d5db;border-radius:.5rem;padding:1.25rem }
        .budget-input{ width:100%; padding:.5rem .75rem; border:1px solid #d1d5db; border-radius:.375rem }
    </style>
</head>
<body class="p-6 md:p-10">
    <div class="max-w-screen-xl mx-auto">
        <header class="mb-6">
            <h1 id="pageTitle" class="text-3xl font-extrabold text-gray-900">Trip</h1>
            <p id="pageDates" class="text-gray-600">Dates</p>
        </header>

        <section class="mb-6 p-4 bg-white rounded-lg border border-gray-200">
            <h2 class="font-bold">Key Planning Assumptions</h2>
            <ul id="planningAssumptions" class="list-disc list-inside"></ul>
        </section>

        <nav class="mb-6 p-1 bg-gray-100 rounded-lg inline-flex">
            <button class="tab-button active" data-tab="agenda">Agenda</button>
            <button class="tab-button" data-tab="villas">Villa Options</button>
            <button class="tab-button" data-tab="map">Map</button>
            <button class="tab-button" data-tab="venues">Party Venues</button>
            <button class="tab-button" data-tab="activities">Activities</button>
            <button class="tab-button" data-tab="budget">Budget</button>
        </nav>

        <main>
            <div id="agenda" class="tab-content active">
                <div id="agendaGrid" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6"></div>
            </div>

            <div id="villas" class="tab-content">
                <div id="villaGrid" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6"></div>
            </div>

            <div id="map" class="tab-content">
                <div class="map-container">
                    <h3>Map</h3>
                    <div class="map-iframe-wrapper" style="padding-top:56.25%"><iframe id="mapIframe" src="about:blank" style="position:absolute;inset:0;width:100%;height:100%;border:0"></iframe></div>
                </div>
            </div>

            <div id="venues" class="tab-content">
                <div id="partyGrid" class="grid grid-cols-1 md:grid-cols-2 gap-6"></div>
            </div>

            <div id="activities" class="tab-content">
                <div id="activitiesGrid" class="grid grid-cols-1 md:grid-cols-2 gap-6"></div>
            </div>

            <div id="budget" class="tab-content">
                <div class="budget-container">
                    <h3>Budget Calculator</h3>
                    <div class="grid grid-cols-1 lg:grid-cols-2 gap-6 mt-4">
                        <div>
                            <div id="villaOptions"></div>
                            <div class="mt-4">
                                <label class="block font-medium">Flights (total)</label>
                                <input id="flightCost" type="number" class="budget-input mt-1" />
                            </div>
                            <div class="mt-4">
                                <label class="block font-medium">Food</label>
                                <input id="foodCost" type="number" class="budget-input mt-1" />
                            </div>
                            <div class="mt-4">
                                <label class="block font-medium">Party</label>
                                <input id="partyCost" type="number" class="budget-input mt-1" />
                            </div>
                            <div class="mt-4">
                                <label class="block font-medium">Taxis</label>
                                <input id="taxiCost" type="number" class="budget-input mt-1" />
                            </div>
                            <div class="mt-4">
                                <label class="block font-medium">VIP</label>
                                <input id="vipCost" type="number" class="budget-input mt-1" />
                            </div>
                        </div>
                        <div>
                            <div class="summary-box">
                                <div class="flex justify-between"><span>Villa:</span><strong id="summaryVilla">0.00 CHF</strong></div>
                                <div class="flex justify-between"><span>Flights:</span><strong id="summaryFlights">0.00 CHF</strong></div>
                                <div class="flex justify-between"><span>Food:</span><strong id="summaryFood">0.00 CHF</strong></div>
                                <div class="flex justify-between"><span>Party:</span><strong id="summaryParty">0.00 CHF</strong></div>
                                <div class="flex justify-between"><span>Taxis:</span><strong id="summaryTaxis">0.00 CHF</strong></div>
                                <div class="flex justify-between"><span>VIP:</span><strong id="summaryVIP">0.00 CHF</strong></div>
                                <hr class="my-4" />
                                <div class="text-center"><div>TOTAL</div><div id="totalCostDisplay" class="text-2xl font-bold">0.00 CHF</div></div>
                                <div class="text-center mt-4"><div>Per Head</div><div id="costPerHeadDisplay" class="text-2xl font-bold">0.00 CHF</div></div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

        </main>
    </div>

    <script src="trip_data.js"></script>
    <script>
        // Tab wiring
        document.querySelectorAll('.tab-button').forEach(btn=> btn.addEventListener('click', ()=>{
            document.querySelectorAll('.tab-button').forEach(b=>b.classList.remove('active'));
            document.querySelectorAll('.tab-content').forEach(c=>c.classList.remove('active'));
            btn.classList.add('active');
            document.getElementById(btn.getAttribute('data-tab')).classList.add('active');
        }));

        // Rendering helpers
        function createHourLines(){
            let out = '';
            for(let i=0;i<24;i++){
                const hh = String(i).padStart(2,'0')+':00';
                out += `<div class="hour-line"><div class="hour-label">${hh}</div></div>`;
            }
            return out;
        }

        function renderAgenda(){
            const container = document.getElementById('agendaGrid');
            container.innerHTML = '';
            tripData.days.forEach(day=>{
                const dayEl = document.createElement('div');
                dayEl.className = 'calendar-day';
                dayEl.innerHTML = `
                    <div class="day-header"><h2 class="day-title">${day.date}</h2><p class="day-subtitle">${day.subtitle||''}</p></div>
                    <div class="timeline-wrapper">
                        <div class="hour-lines">${createHourLines()}</div>
                    </div>
                `;
                const timeline = dayEl.querySelector('.timeline-wrapper');
                day.events.forEach(ev=>{
                    const dur = ev.end - ev.start; // minutes
                    const div = document.createElement('div');
                    div.className = 'event-block '+(ev.type?ev.type+'-slot':'');
                    div.setAttribute('title', `${formatTime(ev.start)} - ${formatTime(ev.end)}: ${ev.title}`);
                    div.style.top = `calc((${ev.start} * var(--minute-height)))`;
                    div.style.height = `calc(${dur} * var(--minute-height))`;
                    div.innerHTML = `<h3>${formatTime(ev.start)} — ${ev.title}</h3><p>${ev.desc||''}</p>`;
                    timeline.appendChild(div);
                });
                container.appendChild(dayEl);
            });
        }

        function formatTime(min){
            const h = Math.floor(min/60), m = min%60; return String(h).padStart(2,'0')+':'+String(m).padStart(2,'0');
        }

        function renderVillas(){
            const g = document.getElementById('villaGrid'); g.innerHTML='';
            tripData.villas.forEach(v=>{
                const div = document.createElement('div'); div.className='embed-container'+(v.recommended? ' recommended':'');
                div.innerHTML = `<h3 class="">${v.name}</h3><p class="text-gray-600">${v.description}</p><p class="mt-2 font-semibold">Price: ${v.price} CHF</p><a href="${v.link}" target="_blank" class="inline-block mt-3 text-blue-600">Open</a>`;
                g.appendChild(div);
            });
        }

        function renderMap(){
            const iframe = document.getElementById('mapIframe');
            iframe.src = tripData.mapLink || 'about:blank';
        }

        function renderVenues(){
            const g = document.getElementById('partyGrid'); g.innerHTML='';
            tripData.venues.forEach(v=>{
                const div = document.createElement('div'); div.className='embed-container';
                div.innerHTML = `<h3>${v.name}</h3><p class="text-gray-600">${v.desc||''}</p><a href="${v.link}" target="_blank" class="block w-full text-center bg-blue-600 text-white py-3 rounded mt-4">Open ${v.domain||''}</a>`;
                g.appendChild(div);
            });
        }

        function renderActivities(){
            const g = document.getElementById('activitiesGrid'); g.innerHTML='';
            tripData.activities.forEach(a=>{
                const div = document.createElement('div'); div.className='embed-container';
                div.innerHTML = `<h3>${a.name}</h3><p class="text-gray-600">${a.desc||''}</p><a href="${a.link}" target="_blank" class="block w-full text-center bg-blue-600 text-white py-3 rounded mt-4">Open</a>`;
                g.appendChild(div);
            });
        }

        function renderPlanning(){
            const ul = document.getElementById('planningAssumptions'); ul.innerHTML='';
            tripData.planningAssumptions.forEach(line=>{ const li=document.createElement('li'); li.innerHTML=line; ul.appendChild(li); });
        }

        function renderHeader(){ document.getElementById('pageTitle').textContent = tripData.title; document.getElementById('pageDates').textContent = tripData.dates; }

        // Budget
        function setupBudget(){
            const villaOptions = document.getElementById('villaOptions'); villaOptions.innerHTML='';
            tripData.villas.forEach((v,i)=>{
                const label = document.createElement('label'); label.className='block mb-2';
                label.innerHTML = `<input type="radio" name="villa_option" value="${v.price}" ${i===tripData.budgetDefaults.villaIndex? 'checked':''}> ${v.name} — ${v.price} CHF`;
                villaOptions.appendChild(label);
            });
            // populate defaults
            document.getElementById('flightCost').value = tripData.budgetDefaults.flightCost || 0;
            document.getElementById('foodCost').value = tripData.budgetDefaults.foodCost || 0;
            document.getElementById('partyCost').value = tripData.budgetDefaults.partyCost || 0;
            document.getElementById('taxiCost').value = tripData.budgetDefaults.taxiCost || 0;
            document.getElementById('vipCost').value = tripData.budgetDefaults.vipCost || 0;

            // attach listeners
            document.querySelectorAll('#villaOptions input[name="villa_option"]').forEach(i=>i.addEventListener('change', calculateBudget));
            ['flightCost','foodCost','partyCost','taxiCost','vipCost'].forEach(id=>document.getElementById(id).addEventListener('input', calculateBudget));
            calculateBudget();
        }

        function calculateBudget(){
            const format = v => isNaN(v)? '0.00 CHF' : v.toLocaleString('de-CH',{style:'currency',currency:'CHF',minimumFractionDigits:2});
            const villaCost = parseFloat(document.querySelector('input[name="villa_option"]:checked').value) || 0;
            const flightCost = parseFloat(document.getElementById('flightCost').value) || 0;
            const foodCost = parseFloat(document.getElementById('foodCost').value) || 0;
            const partyCost = parseFloat(document.getElementById('partyCost').value) || 0;
            const taxiCost = parseFloat(document.getElementById('taxiCost').value) || 0;
            const vipCost = parseFloat(document.getElementById('vipCost').value) || 0;
            const total = villaCost + flightCost + foodCost + partyCost + taxiCost + vipCost;
            const perHead = total / (tripData.groupSize || 12);
            document.getElementById('summaryVilla').textContent = format(villaCost);
            document.getElementById('summaryFlights').textContent = format(flightCost);
            document.getElementById('summaryFood').textContent = format(foodCost);
            document.getElementById('summaryParty').textContent = format(partyCost);
            document.getElementById('summaryTaxis').textContent = format(taxiCost);
            document.getElementById('summaryVIP').textContent = format(vipCost);
            document.getElementById('totalCostDisplay').textContent = format(total);
            document.getElementById('costPerHeadDisplay').textContent = format(perHead);
        }

        // Initial render
        (function(){
            if(!window.tripData){ console.error('tripData not found; create trip_data.js'); return; }
            renderHeader(); renderPlanning(); renderAgenda(); renderVillas(); renderMap(); renderVenues(); renderActivities(); setupBudget();
        })();
    </script>
</body>
</html>